function Debouncer(callback){this.callback=callback,this.ticking=!1}window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame,Fluid.utils={listenScroll:function(callback){callback=new Debouncer(callback);return window.addEventListener('scroll',callback,!1),callback.handleEvent(),callback},unlistenScroll:function(callback){window.removeEventListener('scroll',callback)},listenDOMLoaded(callback){'loading'!==document.readyState?callback():document.addEventListener('DOMContentLoaded',function(){callback()})},scrollToElement:function(target,offset){target=jQuery(target).offset();target&&jQuery('html,body').animate({scrollTop:target.top+(offset||0),easing:'swing'})},elementVisible:function(element,offsetFactor){offsetFactor=offsetFactor&&0<=offsetFactor?offsetFactor:0;var element=element.getBoundingClientRect(),viewportHeight=window.innerHeight||document.documentElement.clientHeight;return 0<=element.top&&element.top<=viewportHeight*(1+offsetFactor)+element.height/2||0<=element.bottom&&element.bottom<=viewportHeight*(1+offsetFactor)+element.height/2},waitElementVisible:function(selectorOrElement,callback,offsetFactor){var runningOnBrowser='undefined'!=typeof window,isBot=runningOnBrowser&&!('onscroll'in window)||'undefined'!=typeof navigator&&/(gle|ing|ro|msn)bot|crawl|spider|yand|duckgo/i.test(navigator.userAgent);function waitInViewport(element){Fluid.utils.listenDOMLoaded(function(){var wrapper;Fluid.utils.elementVisible(element,offsetFactor)?callback():'IntersectionObserver'in window?new IntersectionObserver(function(entries,ob){entries[0].isIntersecting&&(callback(),ob.disconnect())},{threshold:[0],rootMargin:(window.innerHeight||document.documentElement.clientHeight)*offsetFactor+'px'}).observe(element):wrapper=Fluid.utils.listenScroll(function(){Fluid.utils.elementVisible(element,offsetFactor)&&(Fluid.utils.unlistenScroll(wrapper),callback())})})}runningOnBrowser&&!isBot&&(offsetFactor=offsetFactor&&0<=offsetFactor?offsetFactor:0,'string'==typeof selectorOrElement?this.waitElementLoaded(selectorOrElement,function(element){waitInViewport(element)}):waitInViewport(selectorOrElement))},waitElementLoaded:function(selector,callback){var runningOnBrowser='undefined'!=typeof window,isBot=runningOnBrowser&&!('onscroll'in window)||'undefined'!=typeof navigator&&/(gle|ing|ro|msn)bot|crawl|spider|yand|duckgo/i.test(navigator.userAgent);runningOnBrowser&&!isBot&&('MutationObserver'in window?new MutationObserver(function(records,ob){var ele=document.querySelector(selector);ele&&(callback(ele),ob.disconnect())}).observe(document,{childList:!0,subtree:!0}):Fluid.utils.listenDOMLoaded(function(){function waitLoop(){var ele=document.querySelector(selector);ele?callback(ele):setTimeout(waitLoop,100)}waitLoop()}))},createScript:function(url,onload){var s=document.createElement('script'),url=(s.setAttribute('src',url),s.setAttribute('type','text/javascript'),s.setAttribute('charset','UTF-8'),s.async=!1,'function'==typeof onload&&(window.attachEvent?s.onreadystatechange=function(){var e=s.readyState;'loaded'!==e&&'complete'!==e||(s.onreadystatechange=null,onload())}:s.onload=onload),document.getElementsByTagName('script')),url=0<url.length?url[url.length-1]:document.head||document.documentElement;url.parentNode.insertBefore(s,url.nextSibling)},createCssLink:function(url){var l=document.createElement('link'),url=(l.setAttribute('rel','stylesheet'),l.setAttribute('type','text/css'),l.setAttribute('href',url),document.getElementsByTagName('link')[0]||document.getElementsByTagName('head')[0]||document.head||document.documentElement);url.parentNode.insertBefore(l,url)},loadComments:function(selector,loadFunc){var ele=document.querySelector('#comments[lazyload]');ele?Fluid.utils.waitElementVisible(selector,function(){loadFunc(),ele.removeAttribute('lazyload')},CONFIG.lazyload.offset_factor):loadFunc()},getBackgroundLightness(selectorOrElement){var ele=selectorOrElement,selectorOrElement=((ele='string'==typeof selectorOrElement?document.querySelector(selectorOrElement):ele).ownerDocument.defaultView||window).getComputedStyle(ele).backgroundColor.replace(/rgba*\(/,'').replace(')','').split(/,\s*/);return selectorOrElement.length<3?0:0==(ele=.213*selectorOrElement[0]+.715*selectorOrElement[1]+.072*selectorOrElement[2])||127.5<ele?1:-1},retry(handler,interval,times){var next;times<=0||(next=function(){0<=--times&&!handler()&&setTimeout(next,interval)},setTimeout(next,interval))}},Debouncer.prototype={constructor:Debouncer,update:function(){this.callback&&this.callback(),this.ticking=!1},requestTick:function(){this.ticking||(requestAnimationFrame(this.rafCallback||(this.rafCallback=this.update.bind(this))),this.ticking=!0)},handleEvent:function(){this.requestTick()}};